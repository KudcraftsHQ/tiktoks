<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Sticky Column Width Diagnostic</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Simulate the issue */
    .table-container {
      overflow-x: auto;
      border: 2px solid #e5e7eb;
    }

    table {
      border-collapse: collapse;
    }

    th, td {
      border: 1px solid #e5e7eb;
    }

    .sticky-col {
      position: sticky;
      background: white;
      z-index: 1;
    }

    /* Issue 1: Width set via inline style but padding from class */
    .with-tailwind-padding th {
      @apply px-4; /* 16px left + 16px right = 32px */
    }

    .with-tailwind-padding td {
      @apply p-2; /* 8px all around = 16px horizontal */
    }

    .debug-border {
      outline: 2px solid red;
      outline-offset: -2px;
    }
  </style>
</head>
<body class="p-8 bg-gray-50">
  <h1 class="text-2xl font-bold mb-6">Sticky Column Width Diagnostic</h1>

  <!-- Test 1: BROKEN - Width without accounting for padding -->
  <div class="mb-8">
    <h2 class="text-lg font-semibold mb-3">❌ Test 1: BROKEN - Width = column.getSize() with Tailwind padding</h2>
    <p class="text-sm text-gray-600 mb-3">
      Column widths: 50px, 180px, 150px (but px-4 and p-2 add padding)<br>
      Expected positions: 0px, 50px, 230px<br>
      <strong>Problem: Padding makes actual widths larger!</strong>
    </p>
    <div class="table-container">
      <table class="with-tailwind-padding">
        <thead>
          <tr>
            <!-- Col 0: size=50, left=0 -->
            <th class="sticky-col" style="width: 50px; min-width: 50px; max-width: 50px; left: 0px; box-sizing: border-box;">
              ☑
            </th>
            <!-- Col 1: size=180, should be left=50 BUT actual rendered width of col 0 is 50+32=82px! -->
            <th class="sticky-col debug-border" style="width: 180px; min-width: 180px; max-width: 180px; left: 50px; box-sizing: border-box;">
              Author (MISALIGNED!)
            </th>
            <!-- Col 2: size=150, should be left=230 BUT cumulative is wrong -->
            <th class="sticky-col debug-border" style="width: 150px; left: 230px; box-sizing: border-box;">
              Content (MISALIGNED!)
            </th>
            <th style="width: 150px;">Views</th>
            <th style="width: 150px;">Likes</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="sticky-col" style="width: 50px; min-width: 50px; max-width: 50px; left: 0px; box-sizing: border-box;">☑</td>
            <td class="sticky-col debug-border" style="width: 180px; min-width: 180px; max-width: 180px; left: 50px; box-sizing: border-box;">@user123</td>
            <td class="sticky-col debug-border" style="width: 150px; left: 230px; box-sizing: border-box;">Photo carousel</td>
            <td style="width: 150px;">1.2M</td>
            <td style="width: 150px;">45.3K</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="mt-2 p-3 bg-red-50 border border-red-200 rounded text-sm">
      <strong>Why it's broken:</strong> Column 0 has width=50px BUT with px-4 padding (32px), the actual rendered width is ~82px.
      So Column 1's left=50px is WRONG - it should be left=82px!
    </div>
  </div>

  <!-- Test 2: FIXED - Min-width and max-width properly set -->
  <div class="mb-8">
    <h2 class="text-lg font-semibold mb-3">✅ Test 2: FIXED - Explicit min/max width with padding accounted</h2>
    <p class="text-sm text-gray-600 mb-3">
      Column widths account for padding: 50px (no padding for checkbox), 180px content + 32px padding = 212px, etc.<br>
      Expected positions: 0px, 50px, 262px
    </p>
    <div class="table-container">
      <table class="with-tailwind-padding">
        <thead>
          <tr>
            <!-- Col 0: No padding for checkbox cells -->
            <th class="sticky-col !p-0" style="width: 50px; min-width: 50px; max-width: 50px; left: 0px; box-sizing: border-box;">
              <div class="flex items-center justify-center w-full h-full p-4">☑</div>
            </th>
            <!-- Col 1: Width INCLUDES padding -->
            <th class="sticky-col" style="width: 212px; min-width: 212px; max-width: 212px; left: 50px; box-sizing: border-box;">
              Author (ALIGNED!)
            </th>
            <!-- Col 2: Correctly positioned -->
            <th class="sticky-col" style="width: 182px; min-width: 182px; max-width: 182px; left: 262px; box-sizing: border-box;">
              Content (ALIGNED!)
            </th>
            <th style="width: 150px;">Views</th>
            <th style="width: 150px;">Likes</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="sticky-col !p-0" style="width: 50px; min-width: 50px; max-width: 50px; left: 0px; box-sizing: border-box;">
              <div class="flex items-center justify-center w-full h-full p-2">☑</div>
            </td>
            <td class="sticky-col" style="width: 212px; min-width: 212px; max-width: 212px; left: 50px; box-sizing: border-box;">@user123</td>
            <td class="sticky-col" style="width: 182px; min-width: 182px; max-width: 182px; left: 262px; box-sizing: border-box;">Photo carousel</td>
            <td style="width: 150px;">1.2M</td>
            <td style="width: 150px;">45.3K</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="mt-2 p-3 bg-green-50 border border-green-200 rounded text-sm">
      <strong>Why it's fixed:</strong> Column widths are set correctly accounting for padding!
    </div>
  </div>

  <script>
    // Measure actual widths
    window.addEventListener('load', () => {
      const tables = document.querySelectorAll('table');
      tables.forEach((table, tableIdx) => {
        console.log(`\n=== Table ${tableIdx + 1} ===`);
        const headers = table.querySelectorAll('thead th');
        headers.forEach((th, idx) => {
          const computed = getComputedStyle(th);
          const rect = th.getBoundingClientRect();
          console.log(`Column ${idx}:
            - Inline width: ${th.style.width}
            - Computed width: ${computed.width}
            - Actual rendered width: ${rect.width}px
            - Inline left: ${th.style.left}
            - Computed left: ${computed.left}
            - Padding: ${computed.paddingLeft} + ${computed.paddingRight}
          `);
        });
      });
    });
  </script>
</body>
</html>
